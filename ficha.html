<script>
  const params = new URLSearchParams(window.location.search);
  const tagParam = params.get("tag");
  let endpoint;

  if (tagParam) {
    // Filtrar por tag usando v2 “where”
    endpoint = `https://idgonow.up.railway.app/api/v2/tables/m340oj04ihz4wlu/records?where=${encodeURIComponent(`(tag,eq,${tagParam})`)}`;
  } else {
    // Caída a ID numérico (tu lógica original)
    let recordId = params.get("id");
    if (recordId && recordId.startsWith("ID")) {
      recordId = parseInt(recordId.replace("ID", "").replace(/^0+/, ""));
    }
    endpoint = `https://idgonow.up.railway.app/api/v2/tables/m340oj04ihz4wlu/records/${recordId}`;
  }

  const API_TOKEN = "HzyX5A2ycuqlDhV2uyiQ-12UhN_DM0uO4Bfxe7hy";
  let ubicacionTmp = {};

  fetch(endpoint, { headers: { "xc-token": API_TOKEN } })
    .then(res => {
      if (!res.ok) throw new Error(`${res.status} ${res.statusText}`);
      return res.json();
    })
    .then(data => {
      let record;
      if (tagParam) {
        // API devuelve { list: [...] }
        record = Array.isArray(data.list) && data.list[0];
        if (!record) {
          document.getElementById("titulo").innerText = `❌ No hay ficha para el tag “${tagParam}”.`;
          return;
        }
        record = record.fields;
      } else {
        record = data.fields || data;
      }

      // --- El resto es exactamente tu código existente para renderizar la ficha ---
      document.getElementById("titulo").innerText = "Hola, soy " + (record["Nombre"] || "");
      // … foto, infoCentral, datosContacto, botones, etc. …
    })
    .catch(err => {
      document.getElementById("titulo").innerText = "Error al consultar la API: " + err.message;
    });

  // Tus funciones de geolocalización quedan igual:
  function enviarUbicacion(tel, nombre) { /* … */ }
  function confirmarUbicacion() { /* … */ }
  function cerrarModal() { /* … */ }
</script>

