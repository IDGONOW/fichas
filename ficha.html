<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ficha IDGoNow</title>
  <style>
    body { font-family: sans-serif; background: #f2f2f2; padding: 2rem; display: flex; justify-content: center; }
    .card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      width: 100%;
      max-width: 460px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      text-align: center;
    }
    .card img.logo { width: 100px; margin-bottom: 1rem; }
    .foto-circular {
      width: 140px; height: 140px; border-radius: 50%; object-fit: cover;
      border: 4px solid #ddd; margin: 1rem auto;
    }
    h2 { margin-top: 0.5rem; }
    .info, .contacto {
      background: #f8f8f8; margin-top: 1rem; padding: 1rem; border-radius: 10px;
      text-align: left;
    }
    .info p, .contacto p { margin: 0.4rem 0; }
  </style>
</head>
<body>
  <div class="card">
    <img class="logo" src="https://i.imgur.com/r6g9Rud.png" />
    <h2 id="titulo">Cargando...</h2>
    <img id="foto" class="foto-circular" src="" alt="Foto" />
    <div class="info" id="info"></div>
    <div class="contacto" id="contacto"></div>
  </div>

  <script>
    const tag = new URLSearchParams(window.location.search).get("tag");
    const API_TOKEN = "HzyX5A2ycuqlDhV2uyiQ-12UhN_DM0uO4Bfxe7hy";
    const API_URL = `https://idgonow.up.railway.app/api/v2/tables/m340oj04ihz4wlu/records?filters=${encodeURIComponent(JSON.stringify({ tag: { _eq: tag } }))}`;

    fetch(API_URL, {
      headers: { "xc-token": API_TOKEN }
    })
    .then(res => res.json())
    .then(data => {
      const row = data.list[0];
      if (!row) {
        document.getElementById("titulo").innerText = "Tag no encontrado";
        return;
      }
      document.getElementById("titulo").innerText = "Hola, soy " + (row["Nombre"] || "");
      document.getElementById("foto").src = row["Foto"]?.[0]?.path ? `https://idgonow.up.railway.app/${row["Foto"][0].path}` : "";

      const info = document.getElementById("info");
      const contacto = document.getElementById("contacto");

      const camposInfo = {
        "Edad": row["Edad"],
        "Raza": row["Raza y características"],
        "Tipo": row["Tipo de mascota"],
        "Información médica": row["Información médica o datos útiles"]
      };

      const camposContacto = {
        "Contacto": row["Nombre del contacto"],
        "Teléfono": row["Teléfono de contacto"],
        "Correo": row["Correo de contacto"]
      };

      for (const [k, v] of Object.entries(camposInfo)) {
        if (v) info.innerHTML += `<p><strong>${k}:</strong> ${v}</p>`;
      }
      for (const [k, v] of Object.entries(camposContacto)) {
        if (v) contacto.innerHTML += `<p><strong>${k}:</strong> ${v}</p>`;
      }
    })
    .catch(err => {
      console.error("Error:", err);
      document.getElementById("titulo").innerText = "Error al cargar ficha";
    });
  </script>
</body>
</html>

