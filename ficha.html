
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>IDGoNow | Ficha</title>
</head>
<body>
  <div id="contenido" style="max-width:500px; margin:20px auto; text-align:center;">
    <img src="https://i.imgur.com/r6g9Rud.png" alt="Logo IDGoNow" style="width:140px;" />
    <h2 id="titulo">Cargando ficha...</h2>
    <img id="foto" style="width:160px; height:160px; border-radius:50%; object-fit:cover;" />
    <div id="infoCentral"></div>
    <div id="datosContacto"></div>
  </div>
  <script>
    const params = new URLSearchParams(window.location.search);
    const tag = params.get("tag");
    const API_TOKEN = "HzyX5A2ycuqlDhV2uyiQ-12UhN_DM0uO4Bfxe7hy";
    const TABLE_ID = "m340oj04ihz4wlu";
    const BASE_URL = "https://idgonow.up.railway.app";

    if (!tag) {
      document.getElementById("titulo").innerText = "❌ Tag no especificado";
    } else {
      const filtro = encodeURIComponent(JSON.stringify({ where: { tag: tag } }));
      const query = `${BASE_URL}/api/v2/tables/${TABLE_ID}/records?filter=${filtro}`;
      fetch(query, {
        headers: { "xc-token": API_TOKEN }
      })
      .then(res => res.json())
      .then(data => {
        if (!data.list || data.list.length === 0) {
          document.getElementById("titulo").innerText = "❌ Tag no encontrado";
          return;
        }
        const record = data.list[0];
        document.getElementById("titulo").innerText = "Hola, soy " + (record.Nombre || "");
        const foto = record.Foto && Array.isArray(record.Foto) && record.Foto[0].path
          ? `${BASE_URL}/${record.Foto[0].path}` : "";
        if (foto) document.getElementById("foto").src = foto;

        const infoCentral = document.getElementById("infoCentral");
        const contacto = document.getElementById("datosContacto");

        function agregarLinea(titulo, valor, contenedor) {
          if (valor) contenedor.innerHTML += `<p><strong>${titulo}:</strong> ${valor}</p>`;
        }

        agregarLinea("Edad", record["Edad"], infoCentral);
        agregarLinea("Tipo", record["Tipo de mascota"], infoCentral);
        agregarLinea("Raza", record["Raza y características"], infoCentral);
        agregarLinea("Información médica o datos útiles", record["Información médica o datos útiles"], infoCentral);
        agregarLinea("Nombre", record["Nombre del contacto"], contacto);
        agregarLinea("Teléfono", record["Teléfono de contacto"], contacto);
        agregarLinea("Correo", record["Correo de contacto"], contacto);
      })
      .catch(() => {
        document.getElementById("titulo").innerText = "❌ Error al cargar la ficha";
      });
    }
  </script>
</body>
</html>
