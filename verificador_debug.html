<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verificador Debug Final</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      padding: 2rem;
      text-align: center;
    }
    .box {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px #ccc;
    }
    code {
      display: block;
      background: #eee;
      margin: 10px auto;
      padding: 10px;
      border-radius: 6px;
      text-align: left;
      white-space: pre-wrap;
    }
    button {
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      font-size: 16px;
      background: #007b8f;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>üîç Verificando TAG...</h2>
    <div id="log">Iniciando...</div>
    <div id="actions"></div>
  </div>

  <script>
    const tag = new URLSearchParams(window.location.search).get("tag");
    const API_TOKEN = "HzyX5A2ycuqlDhV2uyiQ-12UhN_DM0uO4Bfxe7hy";
    const TABLE_ID = "m340oj04ihz4wlu";
    const BASE_URL = "https://idgonow.up.railway.app";
    const logDiv = document.getElementById("log");
    const actions = document.getElementById("actions");

    function log(msg) {
      console.log(msg);
      logDiv.innerHTML += "<code>" + msg + "</code>";
    }

    if (!tag) {
      log("‚ùå No se especific√≥ ning√∫n tag.");
    } else {
      log("üì¶ TAG recibido: " + tag);
      const API_URL = `${BASE_URL}/api/v2/tables/${TABLE_ID}/records?filter[where][tag]=${encodeURIComponent(tag)}`;
      log("üì° Consultando: " + API_URL);

      fetch(API_URL, {
        headers: { "xc-token": API_TOKEN }
      })
      .then(res => {
        log("üîÅ C√≥digo de estado HTTP: " + res.status);
        return res.json();
      })
      .then(data => {
        log("üì® JSON recibido:
" + JSON.stringify(data, null, 2));
        const records = Array.isArray(data.list) ? data.list : [];
        if (records.length > 0) {
          log("‚úÖ TAG encontrado");
          actions.innerHTML = `<button onclick="location.href='ficha.html?tag=${tag}'">Ir a ficha</button>`;
        } else {
          log("‚ùå TAG no encontrado");
          actions.innerHTML = `<button onclick="location.href='index.html'">Ir al registro</button>`;
        }
      })
      .catch(err => {
        log("‚ùå Error en consulta: " + err);
        actions.innerHTML = `<button onclick="location.href='index.html'">Ir al registro</button>`;
      });
    }
  </script>
</body>
</html>