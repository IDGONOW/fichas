<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verificando TAG...</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      padding: 2rem;
      text-align: center;
    }
    .box {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px #ccc;
    }
    code {
      background: #eee;
      padding: 2px 4px;
      border-radius: 4px;
      display: block;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <div class="box">
    <h2>üîç Verificando TAG...</h2>
    <div id="log">Cargando...</div>
  </div>

  <script>
    const tag = new URLSearchParams(window.location.search).get("tag");
    const API_TOKEN = "HzyX5A2ycuqlDhV2uyiQ-12UhN_DM0uO4Bfxe7hy";
    const TABLE_ID = "m340oj04ihz4wlu";
    const BASE_URL = "https://idgonow.up.railway.app";
    const logDiv = document.getElementById("log");

    function log(msg) {
      console.log(msg);
      logDiv.innerHTML += "<code>" + msg + "</code>";
    }

    if (!tag) {
      log("‚ùå No se especific√≥ ning√∫n tag.");
    } else {
      log("üì¶ TAG recibido: " + tag);
      const API_URL = `${BASE_URL}/api/v2/tables/${TABLE_ID}/records?filter[where][tag]=${encodeURIComponent(tag)}`;
      log("üì° Consultando: " + API_URL);

      fetch(API_URL, {
        headers: { "xc-token": API_TOKEN }
      })
      .then(res => {
        log("üîÅ Respuesta HTTP: " + res.status);
        return res.json();
      })
      .then(data => {
        log("üì® Respuesta JSON: " + JSON.stringify(data));
        const records = Array.isArray(data.list) ? data.list : data;
        if (records.length > 0) {
          log("‚úÖ TAG encontrado. Redirigiendo a ficha...");
          setTimeout(() => {
            location.href = `ficha.html?tag=${encodeURIComponent(tag)}`;
          }, 1500);
        } else {
          log("‚ùå TAG no encontrado. Redirigiendo a registro...");
          setTimeout(() => {
            location.href = `index.html`;
          }, 1500);
        }
      })
      .catch(err => {
        log("‚ùå Error en consulta: " + err);
        setTimeout(() => {
          location.href = `index.html`;
        }, 1500);
      });
    }
  </script>
</body>
</html>