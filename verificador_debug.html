<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Verificador Debug</title>
  <style>
    body { font-family: sans-serif; background: #f4f4f4; text-align: center; padding-top: 40px; }
    .card { background: white; padding: 2em; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 90%; max-width: 480px; margin: auto; }
    .status { font-size: 1.2em; margin-top: 10px; }
    .error { color: red; font-weight: bold; margin-top: 10px; }
    .ok { color: green; font-weight: bold; margin-top: 10px; }
    a.button { display: inline-block; margin-top: 20px; padding: 0.7em 1.5em; background: #007b8f; color: white; text-decoration: none; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>üîç Verificando TAG...</h2>
    <div id="estado">Iniciando...</div>
    <div id="debug"></div>
    <div id="resultado" class="status"></div>
    <div id="link"></div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const tag = params.get("tag");
    const BASE_URL = "https://idgonow.up.railway.app/api/v2";
    const TABLE_ID = "m340oj04ihz4wlu";
    const TOKEN = "HzyX5A2ycuqlDhV2uyiQ-12UhN_DM0uO4Bfxe7hy";

    const debugDiv = document.getElementById("debug");
    const estado = document.getElementById("estado");
    const resultado = document.getElementById("resultado");
    const linkDiv = document.getElementById("link");

    if (!tag) {
      estado.innerHTML = "<span class='error'>‚ùå No se especific√≥ ning√∫n tag.</span>";
      throw new Error("Falta el par√°metro ?tag=");
    }

    const apiUrl = `${BASE_URL}/tables/${TABLE_ID}/records?filters=` + encodeURIComponent(JSON.stringify({ tag: { _eq: tag } }));

    debugDiv.innerHTML = `<p>üì° Consultando:<br><code>${apiUrl}</code></p>`;

    fetch(apiUrl, {
      headers: { "xc-token": TOKEN }
    })
    .then(res => {
      resultado.innerText = `üìã Status: ${res.status}`;
      if (!res.ok) throw new Error("Respuesta HTTP no OK");
      return res.json();
    })
    .then(data => {
      console.log("üì¶ Datos recibidos:", data);
      if (data.list && data.list.length > 0) {
        const id = data.list[0].id;
        resultado.innerHTML = `<span class='ok'>‚úÖ TAG encontrado ‚Üí Redirigir a ficha con id=${id}</span>`;
        linkDiv.innerHTML = `<a class="button" href="ficha.html?id=${id}">Ver ficha</a>`;
      } else {
        resultado.innerHTML = "<span class='error'>‚ùå TAG no encontrado</span>";
        linkDiv.innerHTML = `<a class="button" href="index.html">Ir al registro</a>`;
      }
    })
    .catch(err => {
      resultado.innerHTML = `<span class='error'>‚ö†Ô∏è Error al consultar: ${err.message}</span>`;
      console.error("‚ùå Error en fetch:", err);
    });
  </script>
</body>
</html>