<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro Persona | IDGoNow</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      padding: 1rem;
      max-width: 700px;
      margin: auto;
      text-align: center;
    }
    .logo {
      margin-bottom: 1rem;
    }
    .logo img {
      width: 160px;
    }
    iframe {
      width: 100%;
      height: 750px;
      border: none;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="logo">
    <img src="https://i.imgur.com/r6g9Rud.png" alt="IDGoNow Logo" />
  </div>
  <h2>Registro de Persona</h2>
  <p>Completa el formulario para registrar la identificaci√≥n.</p>

  <iframe id="formIframe"
    src="https://idgonow.up.railway.app/api/embed/form/9b70ceb6-6e3a-436a-9ade-2136148023d6">
  </iframe>

  <script>
    let lastKnownId = null;

    async function checkNewRecord() {
      try {
        const res = await fetch("https://idgonow.up.railway.app/api/v1/db/data/v1/pg9x94vtxgric6p/m1ebsgkhbspdiqq?page=1&limit=1&sort=Id%20desc", {
          headers: {
            "xc-token": "HzyX5A2ycuqlDhV2uyiQ-12UhN_DM0uO4Bfxe7hy"
          }
        });
        const data = await res.json();
        const currentId = data.list?.[0]?.Id;
        if (currentId && currentId !== lastKnownId) {
          lastKnownId = currentId;
          setTimeout(() => {
            window.location.href = `https://idgonow.github.io/fichas/ficha.html?id=${currentId}`;
          }, 1500);
        }
      } catch (err) {
        console.error("Error consultando NocoDB:", err);
      }
    }

    setInterval(checkNewRecord, 4000);
  </script>
</body>
</html>
